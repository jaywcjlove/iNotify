{"version":3,"file":"notify.min.js","sources":["../src/main.js"],"sourcesContent":["// 提醒是否添加chrome通知\nif (window.Notification && window.Notification.permission !== 'granted') {\n  window.Notification.requestPermission().then((permission) => {\n    if (permission === 'denied') {\n      console.log(\"Permission wasn't granted. Allow a retry.\");\n      return;\n    }\n    if (permission === 'default') {\n      console.log('The permission request was dismissed.');\n      return;\n    }\n  });\n}\nlet iconURL = '';\nconst repeatableEffects = ['flash', 'scroll'];\n\nconst defaultNotification = {\n  title: 'iNotify !',\n  body: 'You have a new message.',\n  openurl: '',\n};\nfunction jsonArguments(news, olds) {\n  for (const a in olds) {\n    if (news[a]) {\n      olds[a] = news[a];\n    }\n  }\n  return olds;\n}\nfunction isArray(value) {\n  return Object.prototype.toString.call(value) === '[object Array]';\n}\n\nfunction createAudio(url) {\n  const audioElm = document.createElement('audio');\n  audioElm.autoplay = true;\n  audioElm.muted = true;\n  let source;\n  if (isArray(url) && url.length > 0) {\n    for (let i = 0; i < url.length; i++) {\n      source = document.createElement('source');\n      source.src = url[i];\n      source.type = `audio/${getExtension(url[i])}`;\n      audioElm.appendChild(source);\n    }\n  } else {\n    audioElm.src = url;\n  }\n  return audioElm;\n}\n\nfunction getFavicon(setting) {\n  let ic = document.querySelectorAll('link[rel~=shortcut]')[0];\n  if (!ic) {\n    ic = changeFavicon('O', setting);\n  }\n  return ic;\n}\n\nfunction getExtension(fileName) {\n  return fileName.match(/\\.([^\\\\.]+)$/)[1];\n}\n\nfunction changeFavicon(num, settings) {\n  const canvas = document.createElement('canvas');\n  const head = document.getElementsByTagName('head')[0];\n  const linkTag = document.createElement('link');\n  let ctx = null;\n\n  canvas.height = 32;\n  canvas.width = 32;\n  ctx = canvas.getContext('2d');\n  ctx.fillStyle = settings.backgroundColor;\n  ctx.fillRect(0, 0, 32, 32);\n\n  ctx.textAlign = 'center';\n  ctx.font = '22px \"helvetica\", sans-serif';\n  ctx.fillStyle = settings.textColor;\n  num && ctx.fillText(num, 16, 24);\n\n  // 生成到\n  linkTag.setAttribute('rel', 'shortcut icon');\n  linkTag.setAttribute('type', 'image/x-icon');\n  linkTag.setAttribute('id', `new${settings.id}`);\n  linkTag.setAttribute('href', canvas.toDataURL('image/png'));\n  iconURL = canvas.toDataURL('image/png');\n  return head.appendChild(linkTag);\n}\n\nfunction Notify(config) {\n  if (config) {\n    this.init(config);\n  }\n}\n\nNotify.prototype = {\n  init(config) {\n    if (!config) {\n      config = {};\n    }\n    this.interval = config.interval || 100; // 响应时长\n    this.effect = config.effect || 'flash'; // 效果\n    this.title = config.title || document.title; // 标题\n    this.message = config.message || this.title; // 原来的标题\n    this.onclick = config.onclick || this.onclick; // 点击事件\n    this.openurl = config.openurl || this.openurl; // 点击事件\n    this.disableFavicon = config.disableFavicon || false; // 禁用favicon 默认开启\n    this.updateFavicon = !this.disableFavicon\n      && (config.updateFavicon || {\n        id: 'favicon',\n        textColor: '#fff',\n        backgroundColor: '#2F9A00',\n      });\n    this.audio = config.audio || '';\n    this.favicon = !this.disableFavicon && getFavicon(this.updateFavicon);\n    this.cloneFavicon = this.favicon && this.favicon.cloneNode(true);\n    iconURL = config.notification && config.notification.icon\n      ? config.notification.icon\n      : config.icon\n        ? config.icon\n        : this.favicon.href;\n    defaultNotification.icon = iconURL;\n    this.notification = config.notification || defaultNotification;\n    // 初始化生成声音文件节点\n    if (this.audio && this.audio.file) {\n      this.setURL(this.audio.file);\n    }\n    return this;\n  },\n  render() {\n    if (this.effect === 'flash') {\n      document.title = this.title === document.title ? this.message : this.title;\n    } else if (this.effect === 'scroll') {\n      const title = this.message || document.title;\n      if (!this.scrollTitle || !this.scrollTitle.slice(1)) {\n        document.title = title;\n        this.scrollTitle = title;\n      } else {\n        this.scrollTitle = this.scrollTitle.slice(1);\n        document.title = this.scrollTitle;\n      }\n    }\n    return this;\n  },\n  // 设置标题\n  setTitle(str) {\n    if (str === true) {\n      if (repeatableEffects.indexOf(this.effect) >= 0) {\n        return this.addTimer();\n      }\n    } else if (str) {\n      this.message = str;\n      this.scrollTitle = '';\n      this.addTimer();\n    } else {\n      this.clearTimer();\n    }\n    return this;\n  },\n  setURL(url) {\n    if (url) {\n      if (this.audioElm) {\n        this.audioElm.remove();\n      }\n      this.audioElm = createAudio(url);\n      document.body.appendChild(this.audioElm);\n    }\n    return this;\n  },\n  loopPlay() {\n    this.setURL();\n    this.audioElm.loop = true;\n    this.player();\n    return this;\n  },\n  stopPlay() {\n    this.audioElm && ((this.audioElm.loop = false), this.audioElm.pause());\n    return this;\n  },\n  // 播放声音\n  player() {\n    if (!this.audio || !this.audio.file) {\n      return;\n    }\n    if (!this.audioElm) {\n      this.audioElm = createAudio(this.audio.file);\n      document.body.appendChild(this.audioElm);\n    }\n    this.audioElm.muted = false;\n    const resp = this.audioElm.play();\n    if (resp !== undefined) {\n      resp.then(() => {\n        // autoplay starts!\n      }).catch(() => {\n        // show error\n      });\n    }\n    return this;\n  },\n  notify(json = {}) {\n    let nt = this.notification;\n    const url = json.openurl ? json.openurl : this.openurl;\n    const onclick = json.onclick ? json.onclick : this.onclick;\n    if (window.Notification) {\n      if (json) {\n        nt = jsonArguments(json, nt);\n      } else {\n        nt = defaultNotification;\n      }\n      const option = {};\n      option.icon = json.icon ? json.icon : iconURL;\n      option.body = nt.body || json.body;\n      if (json.dir) option.dir = json.dir;\n      const n = new Notification(nt.title || json.title, option);\n      n.onclick = () => {\n        onclick && typeof onclick === 'function' && onclick(n);\n        url && window.open(url);\n      };\n      n.onshow = () => {\n        json.onshow && typeof json.onshow === 'function' && json.onshow(n);\n      };\n      n.onclose = () => {\n        json.onclose && typeof json.onclose === 'function' && json.onclose(n);\n      };\n      n.onerror = () => {\n        json.onerror && typeof json.onerror === 'function' && json.onerror(n);\n      };\n      this.Notifiy = n;\n    }\n    return this;\n  },\n  // 是否许可弹框通知\n  isPermission() {\n    return window.Notification && Notification.permission === 'granted';\n  },\n  // 设置时间间隔\n  setInterval(num) {\n    if (num) {\n      this.interval = num;\n      this.addTimer();\n    }\n    return this;\n  },\n  // 设置网页Icon\n  setFavicon(num) {\n    if (!num && num !== 0) {\n      return this.faviconClear();\n    }\n    const oldicon = document.getElementById(`new${this.updateFavicon.id}`);\n    if (this.favicon) {\n      this.favicon.remove();\n    }\n    if (oldicon) {\n      oldicon.remove();\n    }\n    this.updateFavicon.num = num;\n    changeFavicon(num, this.updateFavicon);\n    return this;\n  },\n  // 设置 Favicon 文字颜色\n  setFaviconColor(color) {\n    if (color) {\n      this.faviconRemove();\n      this.updateFavicon.textColor = color;\n      changeFavicon(this.updateFavicon.num, this.updateFavicon);\n    }\n    return this;\n  },\n  // 设置 Favicon 背景颜色\n  setFaviconBackgroundColor(color) {\n    if (color) {\n      this.faviconRemove();\n      this.updateFavicon.backgroundColor = color;\n      changeFavicon(this.updateFavicon.num, this.updateFavicon);\n    }\n    return this;\n  },\n  faviconRemove() {\n    this.faviconClear();\n    const oldicon = document.getElementById(`new${this.updateFavicon.id}`);\n    if (this.favicon) {\n      this.favicon.remove();\n    }\n    if (oldicon) {\n      oldicon.remove();\n    }\n  },\n  // 添加计数器\n  addTimer() {\n    this.clearTimer();\n    if (repeatableEffects.indexOf(this.effect) >= 0) {\n      this.timer = setInterval(this.render.bind(this), this.interval);\n    }\n    return this;\n  },\n  close() {\n    if (this.Notifiy) this.Notifiy.close();\n  },\n  // 清除Icon\n  faviconClear() {\n    const newicon = document.getElementById(`new${this.updateFavicon.id}`);\n    const head = document.getElementsByTagName('head')[0];\n    const ficon = document.querySelectorAll('link[rel~=shortcut]');\n    newicon && newicon.remove();\n    if (ficon.length > 0) {\n      for (let i = 0; i < ficon.length; i++) {\n        ficon[i].remove();\n      }\n    }\n    head.appendChild(this.cloneFavicon);\n    iconURL = this.cloneFavicon.href;\n    this.favicon = this.cloneFavicon;\n    return this;\n  },\n  // 清除计数器\n  clearTimer() {\n    this.timer && clearInterval(this.timer);\n    document.title = this.title;\n    return this;\n  },\n};\n\nexport default Notify;\n"],"names":["window","Notification","permission","requestPermission","then","console","log","iconURL","repeatableEffects","defaultNotification","title","body","openurl","createAudio","url","audioElm","document","createElement","source","autoplay","muted","value","Object","prototype","toString","call","length","i","src","type","getExtension","appendChild","fileName","match","changeFavicon","num","settings","canvas","head","getElementsByTagName","linkTag","ctx","height","width","getContext","fillStyle","backgroundColor","fillRect","textAlign","font","textColor","fillText","setAttribute","id","toDataURL","Notify","config","this","init","interval","effect","message","onclick","disableFavicon","updateFavicon","audio","favicon","setting","ic","querySelectorAll","getFavicon","cloneFavicon","cloneNode","notification","icon","href","file","setURL","render","scrollTitle","slice","setTitle","str","indexOf","addTimer","clearTimer","remove","loopPlay","loop","player","stopPlay","pause","resp","play","undefined","catch","notify","json","nt","news","olds","a","jsonArguments","option","dir","n","open","onshow","onclose","onerror","Notifiy","isPermission","setInterval","setFavicon","faviconClear","oldicon","getElementById","setFaviconColor","color","faviconRemove","setFaviconBackgroundColor","timer","bind","close","newicon","ficon","clearInterval"],"mappings":"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"}